# Main entrypoint of the workflow. 
# Please follow the best practices: 
# https://snakemake.readthedocs.io/en/stable/snakefiles/best_practices.html,
# in particular regarding the standardized folder structure mentioned there. 
# Snakefile
import os

# Set up config
configfile: "config/AraTha_2epoch.yaml"
n_train_sims = config["n_train_sims"] # number of simulations for training NPE
datadir = config["datadir"] # directory for training data
outdir = config["outdir"] # output directory for posterior


# Get the list of rule files
rule_files = [os.path.join("rules/", f) for f in os.listdir("workflow/rules/") if f.endswith(".smk")]

# Include the rule files
for rule in rule_files:
    include: rule

# Define the final target
rule final:
    input:
        expand(os.path.join(datadir, "{i}.trees"), i=range(n_train_sims)),
        expand(os.path.join(datadir, "theta_{i}.npy"), i=range(n_train_sims)),
        expand(os.path.join(datadir, "x_{j}.npy"), j=range(n_train_sims)),
        os.path.join(outdir, "posterior.pkl"),
        os.path.join(outdir, "default_obs_samples.npy"),
        os.path.join(outdir, "default_obs_corner.png")
